---
layout: post
title: ELF文件解析 
---
ELF文件是Unix和类Unix操作系统下的二进制文件格式，想要学习Linux系统下信息安全的相关知识，ELF文件格式的学习是一道绕不过去的坎。本文就简要分析下ELF文件格式，用以记录ELF学习的点滴。
本文从以下几个模块来对ELF文件进行分析：
1.ELF文件头
2.程序头
3.节头
4.符号
5.重定位
6.动态链接
先来看ELF文件头的格式，ELF文件头由以下结构来描述
```C
typedef struct {
	   unsigned char e_ident[EI_NIDENT];
	   uint16_t      e_type;
	   uint16_t      e_machine;
	   uint32_t      e_version;
	   ElfN_Addr     e_entry;
	   ElfN_Off      e_phoff;
	   ElfN_Off      e_shoff;
	   uint32_t      e_flags;
	   uint16_t      e_ehsize;
	   uint16_t      e_phentsize;
	   uint16_t      e_phnum;
	   uint16_t      e_shentsize;
	   uint16_t      e_shnum;
	   uint16_t      e_shstrndx;
} ElfN_Ehdr;
```
接下来对该结构的成员进行解析：  
`e_ident`&emsp;这是一个长度为16个字节的数组，前4个字节是一组魔数，用来识别该文件是否为ELF格式。<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第一个字节必须为ELFMAG0（0x7f）<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第二个字节必须为ELFMAG1（'E'）<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第三个字节必须为ELFMAG2（'L'）<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第四个字节必须为ELFMAG3（'F'）<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第五个字节为二进制文件类型<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;0:无效的类型<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;1:ELF32文件格式<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;2:ELF64文件格式<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第六个字节为二进制数据的存储模式<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;0:未知的数据模式<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;1:小端模式<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;2:大端模式<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第七个字节为版本号，一般为01<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第八个字节为操作系统和ABI<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;第九个字节为ABI版本<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;剩下的是补齐字节<br/>

`e_type`&emsp;这个成员变量定义了文件的类型<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;ET_REL&emsp;重定位文件<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;ET_EXEC&emsp;可执行文件<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;ET_DYN&emsp;共享库<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;ET_CORE&emsp;核心文件<br/>

`e_machine`&emsp;该成员指定了文件的运行平台<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_NONE&emsp;&emsp;&emsp;&nbsp;An unknown machine<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_M32&emsp;&emsp;&emsp;&emsp;AT&T WE 32100<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_SPARC&emsp;&emsp;&nbsp;&nbsp;Sun Microsystems SPARC<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_386&emsp;&emsp;&emsp;&emsp; Intel 80386<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_68K&emsp;&emsp;&emsp;&emsp; Motorola 68000<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_88K&emsp;&emsp;&emsp;&emsp; Motorola 88000<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_860&emsp;&emsp;&emsp;&emsp; Intel 80860<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_MIPS&emsp;&emsp;&emsp;MIPS RS3000 (big-endian only)<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_PARISC&emsp;&emsp;&nbsp;HP/PA<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_SPARC32PLUS&emsp;SPARC with enhanced instruction set<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_PPC&emsp;&emsp;PowerPC<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_PPC64&emsp;&emsp;PowerPC 64-bit<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_S390&emsp;&emsp;IBM S/390<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_ARM&emsp;&emsp;Advanced RISC Machines<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_SH&emsp;&emsp;Renesas SuperH<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_SPARCV9&emsp;&emsp;SPARC v9 64-bit<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_IA_64&emsp;&emsp;Intel Itanium<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_X86_64&emsp;&emsp;AMD x86-64<br/>
&emsp;&emsp;&emsp;&emsp;&emsp;EM_VAX&emsp;&emsp;DEC Vax<br/>

