---
layout: post
title: ELF文件解析 
---
ELF文件是Unix和类Unix操作系统下的二进制文件格式，想要学习Linux系统下信息安全的相关知识，ELF文件格式的学习是一道绕不过去的坎。本文就简要分析下ELF文件格式，用以记录ELF学习的点滴。
本文从以下几个模块来对ELF文件进行分析：
1.ELF文件头
2.程序头
3.节头
4.符号
5.重定位
6.动态链接
先来看ELF文件头的格式，ELF文件头由以下结构来描述
```C
typedef struct {
	   unsigned char e_ident[EI_NIDENT];
	   uint16_t      e_type;
	   uint16_t      e_machine;
	   uint32_t      e_version;
	   ElfN_Addr     e_entry;
	   ElfN_Off      e_phoff;
	   ElfN_Off      e_shoff;
	   uint32_t      e_flags;
	   uint16_t      e_ehsize;
	   uint16_t      e_phentsize;
	   uint16_t      e_phnum;
	   uint16_t      e_shentsize;
	   uint16_t      e_shnum;
	   uint16_t      e_shstrndx;
} ElfN_Ehdr;
```
接下来对该结构的成员进行解析：  
```C
e_ident	这是一个长度为16个字节的数组，前4个字节是一组魔数，用来识别该文件是否为ELF格式。
		第一个字节必须为ELFMAG0（0x7f）
		第二个字节必须为ELFMAG1（'E'）
		第三个字节必须为ELFMAG2（'L'）
		第四个字节必须为ELFMAG3（'F'）
		第五个字节为二进制文件类型
			0:无效的类型
			1:ELF32文件格式
			2:ELF64文件格式
		六个字节为二进制数据的存储模式
			&emsp;0:未知的数据模式
			&emsp;1:小端模式
			&emsp;2:大端模式
		七个字节为版本号，一般为01
		八个字节为操作系统和ABI
		九个字节为ABI版本
		剩下的是补齐字节

e_type	这个成员变量定义了文件的类型
		ET_REL	重定位文件
		ET_EXEC	可执行文件
		ET_DYN	共享库
		ET_CORE	核心文件

e_machine	该成员指定了文件的运行平台
		EM_NONE		An unknown machine
		EM_M32		AT&T WE 32100
		EM_SPARC	Sun Microsystems SPARC
		EM_386 		Intel 80386
		EM_68K	   	Motorola 68000
		EM_88K	   	Motorola 88000
		EM_860	   	Intel 80860
		EM_MIPS		MIPS RS3000 (big-endian only)
		EM_PARISC	HP/PA
		EM_SPARC32PLUS SPARC with enhanced instruction set
		EM_PPC		PowerPC
		EM_PPC64	PowerPC 64-bit
		EM_S390&IBM S/390
		EM_ARM		Advanced RISC Machines
		EM_SH&emsp	Renesas SuperH
		EM_SPARCV9	SPARC v9 64-bit
		EM_IA_64	Intel Itanium
		EM_X86_64	AMD x86-64
		EM_VAX		DEC Vax
```
